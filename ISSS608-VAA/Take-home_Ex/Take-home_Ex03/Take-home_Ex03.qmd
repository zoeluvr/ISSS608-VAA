---
title: "Take-home Exercise03"
author: "Luo Zheng" 
date: "`r Sys.Date()`"
execute: 
  echo: true
  eval: true
  warning: false
format: html
---

```{r}
pacman::p_load(tidyverse, patchwork, ggthemes, hrbrthemes, ggrepel, dplyr, ggiraph, ggstatsplot, PMCMRplus, performance, parameters, see)
```

```{r}
resale <- read_csv("data/resale_price.csv")
head(resale)
```

```{r}
resale_filter <-
  resale %>% 
  filter(flat_type == c("5 ROOM", "3 ROOM", "4 ROOM")) %>% 
  filter(str_detect(month,"22")) 
head(resale_filter)
```

```{r}
resale_arrange <- 
  resale_filter %>% 
  separate(remaining_lease, into = c("remaining_lease"), sep = "years") %>% 
  transform(resale_price = resale_price/1000) %>% 
  separate(storey_range, into = c(NA, "storey"), sep = "TO ")
head(resale_arrange)
```

```{r}
resale_arrange$storey=as.numeric(resale_arrange$storey) 
head(resale_arrange)
```

```{r}
re <- resale_arrange %>% 
mutate(storey_bins = 
           cut(storey, 
               breaks = c(0,9,21,22,51))) %>% 
transform(unit_price = resale_price/floor_area_sqm)
head(re)
```


```{r}
model_resale <- lm(resale_price ~ floor_area_sqm + lease_commence_date + remaining_lease, data = re)
model_resale
```

```{r}
check_collinearity(model_resale)
```

```{r}
check_r <- check_collinearity(model_resale)
plot(check_r)
```

```{r}
model_resale_1 <- lm(resale_price ~ floor_area_sqm + remaining_lease, data = re)
check_r_1 <- check_normality(model_resale_1)
plot(check_r_1)
```


```{r}
ggbetweenstats(
  data = re,
  x = flat_type, 
  y = resale_price,
  type = "p",
  mean.ci = TRUE, 
  pairwise.comparisons = TRUE, 
  pairwise.display = "s",
  p.adjust.method = "fdr",
  messages = FALSE
)
```

```{r}

ggscatterstats(
  data = re,
  x = remaining_lease,
  y = resale_price,
  marginal = FALSE,
  )
```

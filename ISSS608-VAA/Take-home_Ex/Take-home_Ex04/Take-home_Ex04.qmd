---
title: "Take-home Exercise04"
subtitle: "COVID-19 Influence on Export and Import"
author: "Luo Zheng" 
date: "`r Sys.Date()`"
execute: 
  echo: true
  eval: true
  warning: false
format: html
---

```{r}
pacman::p_load(scales, viridis, lubridate, ggthemes, gridExtra, readxl, knitr, data.table, CGPfunctions, ggHoriPlot, tidyverse)
```

```{r}
impodata <- read_xlsx("data/merc.xlsx",
                       sheet = "T1",
                       range = cell_rows(10:129))  %>% 
  gather("Import_Date", "Import_Value", -`Data Series`)

expodata <- read_xlsx("data/merc.xlsx",
                       sheet = "T2",
                       range = cell_rows(10:129)) %>% 
  gather("Export_Date", "Export_Value", -`Data Series`)
```

```{r}
impodata <- impodata[-1,]
expodata <- expodata[-1,]
```

```{r}
impodata$`Import_Date` <- ym(impodata$`Import_Date`)
expodata$`Export_Date` <- ym(expodata$`Export_Date`)
```

```{r}
impodata$`Import_Value` <- as.numeric(impodata$`Import_Value`)
expodata$`Export_Value` <- as.numeric(expodata$`Export_Value`)
```

```{r}
impodata_million <- impodata %>% 
filter(str_detect(`Data Series`,"Million")) %>% 
  mutate(Import_Value = Import_Value * 1000) %>% 
  rename(`Import_Value(KUSD)` = "Import_Value") %>% 
  mutate(`Data Series` = str_replace_all(`Data Series`, "\\((.*?)\\)", ""))

impodata_thousand <- impodata %>% 
filter(str_detect(`Data Series`,"Thousand")) %>% 
  rename(`Import_Value(KUSD)` = "Import_Value") %>% 
  mutate(`Data Series` = str_replace_all(`Data Series`, "\\((.*?)\\)", ""))

imp <- rbind(impodata_million, impodata_thousand)
```

```{r}
timetool <- function(ct,da,va){
  real_date <- ymd_hms(da,
                      tz = tz[1],
                      quiet = TRUE)
  timecover <- data.table(Country = ct,
                          Year = year(real_date),
                          Month = month.abb(real_date),
                          Value = as.numeric(va))
  return(timecover)
  
}
```

```{r}

```
